#pragma once

#include <curl/curl.h>
#include <iostream>
#include <format>
#include <regex>
#include <Logger.h>

namespace LicenseManager
{
    class HTTPManager
    {
        private:
            std::string macAddress;
            std::string deviceName;
            std::string activationCode;

            std::string licenseTicket;

            std::string baseUrl = "https://localhost";

        public:
            HTTPManager();

            static size_t WriteCallback(void* contents, size_t size, size_t nmemb, void* userp);

            bool sendHttpRequest(
                const std::string& url, const std::string& jsonData, std::string& response, std::string jwtToken);
 
            void LogResponse(std::string response);

            std::string ActivateLicense(
                std::string activationCode,
                std::string name,
                std::string macAddress,
                std::string accessToken
            );
            
            std::string GetAllLicenses(
                std::string name,
                std::string macAddress,
                std::string accessToken
             );

            std::string GetLicenseInfo(
                std::string activationCode,
                std::string deviceName,
                std::string macAddress,
                std::string accessToken
            );

            std::string RefreshTicket(std::string accessToken);

            std::string GetAllRenewal(std::string accessToken);

            std::string RenewalLicense(
                std::string activationCode,
                std::string accessToken
            );

            void DeactivateLicense();

    };
}