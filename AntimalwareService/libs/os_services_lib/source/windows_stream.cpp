#include "../include/public/windows_stream.h"

WindowsStream::WindowsStream(void* handle) {
    m_handle = static_cast<HANDLE>(handle);
}

WindowsStream::~WindowsStream() {
    if (m_handle != INVALID_HANDLE_VALUE)
    {
        CloseHandle(m_handle);
    }
}

uint32_t WindowsStream::Write(uint8_t* data, uint32_t length) {
    DWORD cbWritten = 0;
    BOOL fSuccess = WriteFile(
        static_cast<HANDLE>(m_handle),
        data,
        length,
        &cbWritten,
        NULL
    );

    if (!fSuccess || length != cbWritten) {
        return 0;
    }
    return cbWritten;
}

uint32_t WindowsStream::Read(uint8_t* data, uint32_t length) {
    DWORD cbBytesRead = 0;
    BOOL fSuccess = ReadFile(
        static_cast<HANDLE>(m_handle),
        data,
        length,
        &cbBytesRead,
        NULL
    );

    if (!fSuccess || length != cbBytesRead) {
        return 0;
    }
    return cbBytesRead;
}
