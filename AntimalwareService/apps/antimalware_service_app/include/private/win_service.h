#pragma once

#include <windows.h>
#include <tchar.h>
#include <strsafe.h>
#include <Logger.h>

#pragma comment(lib, "advapi32.lib")
#pragma comment(lib, "kernel32.lib")

// Имя службы
#define SVCNAME TEXT("AntimalwareService")
// Краткое описание службы
#define SVCDISPLAY TEXT("Антивирусная служба")
// Полное описание службы
#define SVCDESCRIPTION TEXT("Антивирусная служба, разрабатываемая для дисциплины \"Защита информации от вредоносного программного обеспечения\"")

// Преобразование const char* в char*
#define WITHOUT_CONST(x) const_cast<char*>(x)

// Состояние службы
extern SERVICE_STATUS          gSvcStatus;
// Дескриптор состояния службы
extern SERVICE_STATUS_HANDLE   gSvcStatusHandle;
// Дескриптор флага остановки работы службы
extern HANDLE                  ghSvcStopEvent;

/* Функция установки службы */
VOID SvcInstall(void);

VOID __stdcall DoStartSvc(void);
VOID __stdcall DoStopSvc(void);
VOID __stdcall DoDeleteSvc(void);
BOOL __stdcall StopDependentServices(SC_HANDLE&, SC_HANDLE&);

/* Обработчик служебных сообщений от SCM */
VOID WINAPI SvcCtrlHandler(DWORD);

/* Сообщение текущего статуса службы SCM */
VOID ReportSvcStatus(DWORD, DWORD, DWORD);